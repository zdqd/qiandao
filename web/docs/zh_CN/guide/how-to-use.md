# 如何使用?

## 获取 HAR

### 1. 什么是 HAR?

HAR：<https://toolbox.googleapps.com/apps/har_analyzer/?lang=zh_CN>

### 2. 抓包

#### 2.1. Chrome 或 Edge

1. 按 `F12` 、 `Ctrl + Shift + I` ，或从 Chrome 菜单中选择 `更多工具` > `开发者工具` 。
2. 从屏幕底部或右侧打开的面板中，选择 `网络` 选项卡。
3. 确保 `网络` 选项卡左上角的 `录制` 按钮显示为 **红色**。
4. 如果它是灰色的，单击一下开始录制。
5. 选中 `保留日志` 旁边的框。
   ![Preserve log](/preserve_log.png)
6. 单击 `清除` 按钮以清除 `网络` 选项卡中的所有现有日志。
7. 现在尝试重现您计划发起的 HTTP 请求。
8. 重现任务后，右键单击网络请求网格上的任意位置。
9. 选择 `另存为带内容的 HAR`。
   ![Save as HAR with Content](/save_har.png)
10. 将文件保存到您的计算机。

#### 2.2. 火狐

1. 按 `F12` （或转到 `Tools` > `Web Developer` > `Network` ）。
2. 现在尝试重现您计划发起的 HTTP 请求。
3. 右键单击​​加载的结果。
4. 选择全部另存为 har。

#### 2.3. Windows - Fiddler

1. 打开 Fiddler，打开 `Tools` 菜单，选择 `Options`。
2. 选择 `HTTPS 选项卡` ，勾选 `Capture HTTPS Connects` 。
3. 选择 `连接` 选项卡，选中 `解密 HTTPS 流量` 。
4. 现在尝试重现您计划发起的 HTTP 请求。
5. 导出为 HAR 格式 - 请选择 HTTPArchive 作为导出方式。

#### 2.4. IOS - Stream

1. 打开 Stream。
2. 抓取HTTPS请求前，需要安装CA证书， `setting` > `General` > `About` > `Certificate Trust Settings` 信任CA证书。
3. 点击开始抓包按钮，手机会自动弹出VPN配置窗口，然后选择允许。
4. 现在尝试重现您计划发起的 HTTP 请求。
5. 在应用页面，点击停止抓拍结束本次抓拍。
6. 导出HAR文件。

### 3. 公共模板

1. 点击 `我的模板` 右侧的 `社区模板` 按钮。
2. 更新存储库以获取最新的 HAR 文件列表。
3. 选择你要使用的HAR文件，点击 `Subscribe` 按钮订阅模板。
4. 根据需要修改模板。
5. 然后跳到 [3.编辑模板](#编辑模板) 继续编辑。

## 上传 HAR 文件

1. 访问并登录 QD 首页。
2. 点击 `我的模板` 右侧的 `+` 按钮。
3. 上传刚刚保存的 HAR 文件。
4. 点击 `上传` 继续。

## 编辑模板

::: v-pre

1. 将用户名、密码、cookie、header 等根据用户变化的部分替换成类似 `{{ username }}` 的模板。（模板支持 **jinja2 语法**）
2. 在请求编辑中使用测试面板测试模板是否正确返回，使用正确和错误的用户名进行测试。
3. 填写 `成功/失败断言`，这有助于检测模板任务是否运行失败。
4. 当请求中需要上一次请求的一些数据时，使用变量抽取，通过正则化抽取数据，保存在环境变量中。使用组选择器 `ab(\w+)cd` 选择其中的一部分。
5. 使用 `__log__` 提取任务日志。
6. 当所有请求编辑完成后，使用下载按钮旁边的 `测试` 来测试整体。
7. 正在编辑的模板会自动保存在浏览器缓存中，不用担心丢失。
8. 单击 `保存` 按钮保存模板。
9. 单击 `下载` 按钮下载模板。
:::

## 创建定时任务

1. 点击 `我的任务` 右侧的 `+` 按钮。
2. 选择刚刚创建的模板。
3. 填写任务变量，任务间隔、任务组和任务执行时间。
4. 单击 `测试` 按钮测试任务。
5. 单击保存按钮保存任务。
